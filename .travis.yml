# Copyright (c) 2019, Giacomo Drago <giacomo@giacomodrago.com>
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither the name of Giacomo Drago nor the
#    names of its contributors may be used to endorse or promote products
#    derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY GIACOMO DRAGO "AS IS" AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL GIACOMO DRAGO BE LIABLE FOR ANY
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

sudo: false
language: generic

matrix:
  include:

    - env: CXX="g++-4.7"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.7

    - env: CXX="g++-4.7" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.7

    - env: CXX="g++-4.8"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.8

    - env: CXX="g++-4.8" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.8

    - env: CXX="g++-4.9"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.9

    - env: CXX="g++-4.9" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-4.9

    - env: CXX="g++-5"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-5

    - env: CXX="g++-5" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-5

    - env: CXX="g++-6"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-6

    - env: CXX="g++-6" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-6

    - env: CXX="g++-7"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-7

    - env: CXX="g++-7" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-7

    - env: CXX="g++-8"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-8

    - env: CXX="g++-8" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources: ubuntu-toolchain-r-test
          packages: valgrind g++-8

    - env: CXX="clang++-3.6"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.6
          packages: valgrind clang++-3.6

    - env: CXX="clang++-3.6" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.6
          packages: valgrind clang++-3.6

    - env: CXX="clang++-4.0"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-4.0
          packages: valgrind clang++-4.0

    - env: CXX="clang++-4.0" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-4.0
          packages: valgrind clang++-4.0

    - env: CXX="clang++-5.0"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-5.0
          packages: valgrind clang++-5.0

    - env: CXX="clang++-5.0" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-5.0
          packages: valgrind clang++-5.0

    - env: CXX="clang++-6.0"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-6.0
          packages: valgrind clang++-6.0

    - env: CXX="clang++-6.0" CPP11="-DCPP11:int=1"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-6.0
          packages: valgrind clang++-6.0


before_install:
  - wget https://github.com/google/googletest/archive/release-1.7.0.zip && unzip release-1.7.0.zip && (cd googletest-release-1.7.0 && cmake . && make)
  - export GTEST_ROOT=${TRAVIS_BUILD_DIR}/googletest-release-1.7.0


script:
  - ${CXX} --version
  - cmake --version
  - mkdir build
  - cd build
  - cmake .. ${CPP11} && make VERBOSE=1 && ./minijson_reader_tests && valgrind --error-exitcode=42 --leak-check=full ./minijson_reader_tests
